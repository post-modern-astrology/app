<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="ALFI">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="ALFI">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png" />

  <title>alfi</title>
  <link rel="manifest" href="manifest.json">
  <meta name="file-picker-web" content="enabled">

  <!-- ВАЖНО: задаем renderer ДО загрузки bootstrap -->
  <script>
    window.flutterWebRenderer = "canvaskit";
    // window.flutterWebRenderer = "html";
  </script>

  <!-- УДАЛЕНО из head:
  <script src="flutter_bootstrap.js" async></script>
  -->

  <!-- Легкий сплэш: стиль и фон, чтобы не было белого экрана -->
  <style>
    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background: #0b0b0b;
      /* подберите под бренд */
      color: #ffffff;
    }

    #splash {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #0b0b0b;
      transition: opacity .25s ease;
      z-index: 9999;
    }

    .spinner {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.25);
      border-top-color: #ffffff;
      animation: spin 1s linear infinite;
    }

    .splash-title {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      font-size: 18px;
      opacity: 0.85;
      margin-top: 16px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
  <!-- <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700&family=Noto+Sans+Symbols+2&family=Noto+Sans+Symbols&display=swap"> -->
</head>

<body>
  <!-- Сплэш-экран до первого кадра Flutter -->
  <div id="splash" aria-label="Loading...">
    <div class="spinner" role="progressbar" aria-busy="true"></div>
    <div class="splash-title">Loading…</div>
  </div>

  <script>
    // Скрываем сплэш, когда Flutter отрисует первый кадр
    window.addEventListener('flutter-first-frame', function () {
      const el = document.getElementById('splash');
      if (!el) return;
      el.style.opacity = '0';
      setTimeout(() => el.remove(), 300);
    });
  </script>

  <!-- ?? -->
  <script>
    // Удаляем здесь дублирование установки renderer,
    // он уже задан в <head> выше
    // Инициализация FilePicker для веб
    window.addEventListener('load', function () {
      // Создаем глобальный объект для FilePicker, если он еще не существует
      if (!window.filePicker) {
        window.filePicker = {
          initialized: true,
          // Создаем полноценный объект instance с методом _instance
          instance: {
            _instance: {}, // Добавляем _instance как объект
            // Добавляем необходимые методы
            pickFiles: function () {
              return Promise.resolve(null);
            }
          }
        };
      }

      // Отправляем событие о готовности FilePicker
      window.dispatchEvent(new CustomEvent('filePickerReady'));
      console.log('FilePicker web initialized');
    });
  </script>
  <!-- Переносим bootstrap в конец body и используем defer -->
  <script src="flutter_bootstrap.js" defer></script>
</body>

</html>